{{ if eq .chezmoi.os "darwin" -}}
#!/bin/zsh

(( $+commands[brew] )) || return 1

echo "Tapping brew repositories...\n"
taps=(
{{- range .pkg.darwin.taps }}
  {{ . | quote }}
{{- end }}
)
for tap in $taps; do
  brew tap -q "$tap"
done

echo "Installing brews and casks...\n"

brew bundle -q --no-upgrade -v --file=/dev/stdin <<EOF
{{ range .pkg.darwin.brews -}}
brew {{ . | quote }}
{{ end -}}
{{ range .pkg.darwin.casks -}}
cask {{ . | quote }}
{{ end -}}
EOF


# pipx installation using zsh loop
pipx_packages=(
{{- range .pkg.darwin.pipx.packages }}
  {{ . | quote }}
{{- end }}
)

echo "Installing pipx packages...\n"

for pkg in $pipx_packages; do
  pipx install -q "$pkg"
done

echo "Injecting pipx packages...\n"

{{- range .pkg.darwin.pipx.injections }}
{{- range $pkg, $deps := . }}
pipx inject -q {{ $pkg | quote }}{{- range $deps }} {{ . | quote }}{{- end }}
{{- end }}
{{- end }}

echo "Done\n"

{{ end -}}
